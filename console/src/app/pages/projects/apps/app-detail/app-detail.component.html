<cnsl-top-view
  title="{{ app?.name }}"
  [hasActions]="!isZitadel && (['project.app.write:' + projectId, 'project.app.write'] | hasRole | async)"
  docLink="https://zitadel.com/docs/guides/manage/console/projects"
  [sub]="app?.oidcConfig ? ('APP.OIDC.APPTYPE.' + app?.oidcConfig?.appType | translate) : app?.apiConfig ? 'API' : 'SAML'"
  [isActive]="app?.state === AppState.APP_STATE_ACTIVE"
  [isInactive]="app?.state === AppState.APP_STATE_INACTIVE"
  stateTooltip="{{ 'APP.PAGES.DETAIL.STATE.' + app?.state | translate }}"
>
  <ng-template topActions cnslHasRole [hasRole]="['project.app.write:' + projectId, 'project.app.write']">
    @if (!isZitadel && app?.oidcConfig && (currentAuthMethod === 'CODE' || currentAuthMethod === 'POST')) {
      <div class="regen-secret">
        <button type="button" [disabled]="!canWrite" mat-menu-item (click)="regenerateOIDCClientSecret()">
          {{ 'APP.OIDC.REGENERATESECRET' | translate }}
        </button>
      </div>
    }

    @if (!isZitadel && app?.apiConfig && currentAuthMethod === 'BASIC') {
      <div class="regen-secret">
        <button [disabled]="!canWrite" mat-menu-item (click)="regenerateAPIClientSecret()">
          {{ 'APP.API.REGENERATESECRET' | translate }}
        </button>
      </div>
    }

    @if (!isZitadel) {
      <button mat-menu-item (click)="openNameDialog()" aria-label="Edit project name">
        {{ 'ACTIONS.RENAME' | translate }}
      </button>
    }
    @if (!isZitadel && app?.state !== AppState.APP_STATE_INACTIVE) {
      <button mat-menu-item (click)="changeState(AppState.APP_STATE_INACTIVE)">
        {{ 'ACTIONS.DEACTIVATE' | translate }}
      </button>
    }
    @if (!isZitadel && app?.state === AppState.APP_STATE_INACTIVE) {
      <button mat-menu-item (click)="changeState(AppState.APP_STATE_ACTIVE)">
        {{ 'ACTIONS.REACTIVATE' | translate }}
      </button>
    }
    <ng-template cnslHasRole [hasRole]="['project.app.delete:' + projectId, 'project.app.delete']">
      @if (!isZitadel) {
        <button mat-menu-item matTooltip="{{ 'APP.PAGES.DELETE' | translate }}" (click)="deleteApp()">
          <span [style.color]="'var(--warn)'">{{ 'APP.PAGES.DELETE' | translate }}</span>
        </button>
      }
    </ng-template>
  </ng-template>
  @if (errorMessage) {
    <span class="app-err-container">{{ errorMessage }}</span>
  }

  @if (app) {
    <cnsl-info-row topContent [app]="app"></cnsl-info-row>
  }
</cnsl-top-view>

<div class="max-width-container">
  @if (isNew()) {
    <cnsl-info-section class="problem" [type]="InfoSectionType.INFO">
      <div class="jumptoproject-row">
        <span class="jumptoproject">{{ 'APP.PAGES.JUMPTOPROJECT' | translate }}</span>
        <a [routerLink]="['/projects', projectId]" color="primary" mat-raised-button>{{
          'ACTIONS.CONFIGURE' | translate
        }}</a>
      </div>
    </cnsl-info-section>
  }

  <div class="app-main-content">
    <cnsl-meta-layout>
      <cnsl-sidenav [(setting)]="currentSetting" [settingsList]="settingsList">
        @if (currentSetting.id === 'quickstart') {
          <cnsl-card [collapsible]="false" title="{{ 'APP.OVERVIEW_DETAIL.TITLE' | translate }}">
            <div class="overview-content">
              @if (isAuthenticated() === false) {
                <div class="auth-status-section">
                  <div
                    class="status-indicator"
                    [ngClass]="{
                      'status-not-authenticated': isAuthenticated() === false,
                      'status-loading': isAuthenticated() === null,
                    }"
                  >
                    <div class="status-icon">
                      @if (isAuthenticated() === null) {
                        <i class="las">la-spinner la-spin</i>
                      }
                      @if (isAuthenticated() === false) {
                        <i class="las la-exclamation-circle"></i>
                      }
                    </div>
                    <div class="status-text">
                      @if (isAuthenticated() === null) {
                        <span>{{ 'APP.OVERVIEW_DETAIL.AUTH_STATUS_CHECKING' | translate }}</span>
                      }
                      @if (isAuthenticated() === false) {
                        <span>{{ 'APP.OVERVIEW_DETAIL.AUTH_STATUS_PENDING' | translate }}</span>
                      }
                      @if (isAuthenticated() === false) {
                        <span class="status-description">
                          {{ 'APP.OVERVIEW_DETAIL.AUTH_STATUS_PENDING_DESC' | translate }}
                        </span>
                      }
                    </div>
                  </div>
                </div>
              }

              <div class="integration-flow">
                <div class="scenarios-section">
                  <div class="scenario-header">
                    <div class="header-content">
                      <h4>{{ 'APP.OVERVIEW_DETAIL.QUICKSTART' | translate }}</h4>
                      <p class="subtitle">{{ 'APP.OVERVIEW_DETAIL.QUICKSTART_SUBTITLE' | translate }}</p>
                    </div>
                  </div>

                  <div class="scenario-toggle">
                    <button mat-button [class.active]="selectedScenario === 'new'" (click)="switchScenario('new')">
                      <span class="icon">ðŸš€</span>
                      {{ 'APP.OVERVIEW_DETAIL.SCENARIO_NEW_TOGGLE' | translate }}
                    </button>
                    <button mat-button [class.active]="selectedScenario === 'existing'" (click)="switchScenario('existing')">
                      <span class="icon"><i class="las la-code"></i></span>
                      {{ 'APP.OVERVIEW_DETAIL.SCENARIO_EXISTING_TOGGLE' | translate }}
                    </button>
                  </div>

                  <!-- Framework selector (shown when no framework is selected and not a custom app) -->
                  @if (!framework && !isCustomApp) {
                    <div class="framework-selector-section">
                      <h5>{{ 'APP.OVERVIEW_DETAIL.SELECT_FRAMEWORK' | translate }}</h5>
                      <p class="framework-selector-desc">{{ 'APP.OVERVIEW_DETAIL.SELECT_FRAMEWORK_DESC' | translate }}</p>
                      <cnsl-framework-autocomplete
                        (selectionChanged)="selectFrameworkById($event)"
                      ></cnsl-framework-autocomplete>
                    </div>
                  }

                  @if (selectedScenario === 'new') {
                    <div class="new-app-scenario">
                      <cnsl-info-section>{{ 'APP.OVERVIEW_DETAIL.SCENARIO_NEW_DESC' | translate }}</cnsl-info-section>
                      <cnsl-card>
                        <div class="integration-steps">
                          @if (hasExample()) {
                            <div class="step-item">
                              <div class="step-number">1</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP1_TITLE' | translate }}</h6>
                                <p>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP1_DESC' | translate }}</p>

                                <div class="code-block">
                                  <div class="code-header">
                                    <span>{{ 'APP.OVERVIEW_DETAIL.TERMINAL' | translate }}</span>
                                    <button
                                      mat-icon-button
                                      [disabled]="copied === 'clone'"
                                      (click)="copyToClipboard(getCloneCommand(), 'clone')"
                                      matTooltip="{{ 'ACTIONS.COPY' | translate }}"
                                    >
                                      <i
                                        class="las"
                                        [ngClass]="copied === 'clone' ? 'la-check text-green-500' : 'la-copy'"
                                      ></i>
                                    </button>
                                  </div>
                                  <pre class="code-content">{{ getCloneCommand() }}</pre>
                                </div>
                              </div>
                            </div>
                          }

                          @if (!hasAnyFrameworkContent()) {
                            <div class="step-item">
                              <div class="step-number">1</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.GENERIC_NEW_TITLE' | translate }}</h6>
                                <div class="generic-guidance">
                                  <p>{{ 'APP.OVERVIEW_DETAIL.GENERIC_NEW_NOTE' | translate }}</p>
                                  <div class="generic-links">
                                    <a
                                      href="https://zitadel.com/docs/sdk-examples/introduction"
                                      target="_blank"
                                      mat-raised-button
                                      color="primary"
                                    >
                                      {{ 'APP.OVERVIEW_DETAIL.BROWSE_EXAMPLES' | translate }}
                                    </a>
                                    <a href="https://zitadel.com/docs/guides/integrate" target="_blank" mat-stroked-button>
                                      {{ 'APP.OVERVIEW_DETAIL.INTEGRATION_GUIDE' | translate }}
                                    </a>
                                  </div>
                                </div>
                              </div>
                            </div>
                          }

                          <div class="step-item">
                            <div class="step-number">{{ hasExample() ? '2' : !hasAnyFrameworkContent() ? '2' : '1' }}</div>
                            <div class="step-content">
                              <h6>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP2_TITLE' | translate }}</h6>
                              <p>
                                {{
                                  (isExampleEnvMode
                                    ? 'APP.OVERVIEW_DETAIL.NEW_STEP2_DESC_EXAMPLE_ENV'
                                    : 'APP.OVERVIEW_DETAIL.NEW_STEP2_DESC'
                                  ) | translate
                                }}
                              </p>
                              @if (requiresClientSecret()) {
                                <cnsl-info-section class="client-secret-note">
                                  <span>
                                    {{ 'APP.OVERVIEW_DETAIL.NEW_STEP2_CLIENT_SECRET_NOTE' | translate }}
                                    <a (click)="regenerateOIDCClientSecret()" class="secret-link">{{
                                      'APP.OVERVIEW_DETAIL.NEW_STEP2_CLIENT_SECRET_LINK' | translate
                                    }}</a
                                    >.
                                  </span>
                                </cnsl-info-section>
                              }
                              <cnsl-env-vars-block
                                [envVars]="envVarsArray"
                                [availableFormats]="isExampleEnvMode ? [] : ['env', 'json', 'yaml']"
                                [showDownload]="!isExampleEnvMode"
                                defaultFormat="env"
                              ></cnsl-env-vars-block>
                            </div>
                          </div>

                          @if (hasBuildCommands()) {
                            <div class="step-item">
                              <div class="step-number">{{ hasExample() ? '3' : !hasAnyFrameworkContent() ? '3' : '2' }}</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP3_TITLE' | translate }}</h6>
                                <p>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP3_DESC' | translate }}</p>
                                <div class="framework-actions">
                                  <div class="code-block">
                                    <div class="code-header">
                                      <span>{{ 'APP.OVERVIEW_DETAIL.TERMINAL' | translate }}</span>
                                      <button
                                        mat-icon-button
                                        [disabled]="copied === 'build'"
                                        (click)="copyToClipboard(getBuildCommand(), 'build')"
                                        matTooltip="{{ 'ACTIONS.COPY' | translate }}"
                                      >
                                        <i
                                          class="las"
                                          [ngClass]="copied === 'build' ? 'la-check text-green-500' : 'la-copy'"
                                        ></i>
                                      </button>
                                    </div>
                                    <pre class="code-content">{{ getBuildCommand() }}</pre>
                                  </div>
                                  <p>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP3_DESC2' | translate }}</p>
                                  <div class="code-block">
                                    <div class="code-header">
                                      <span>{{ 'APP.OVERVIEW_DETAIL.TERMINAL' | translate }}</span>
                                      <button
                                        mat-icon-button
                                        [disabled]="copied === 'run'"
                                        (click)="copyToClipboard(getRunCommand(), 'run')"
                                        matTooltip="{{ 'ACTIONS.COPY' | translate }}"
                                      >
                                        <i
                                          class="las"
                                          [ngClass]="copied === 'run' ? 'la-check text-green-500' : 'la-copy'"
                                        ></i>
                                      </button>
                                    </div>
                                    <pre class="code-content">{{ getRunCommand() }}</pre>
                                  </div>
                                </div>
                              </div>
                            </div>
                          }

                          @if (hasBuildCommands() && hasExampleLink()) {
                            <div class="step-item">
                              <div class="step-number">4</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP4_TITLE' | translate }}</h6>
                                <p>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP4_DESC' | translate }}</p>
                                <div class="framework-actions">
                                  <a
                                    [href]="getFrameworkInfo()?.exampleLink"
                                    target="_blank"
                                    mat-raised-button
                                    color="primary"
                                  >
                                    {{ 'APP.OVERVIEW_DETAIL.STEP4_ACTION' | translate }}
                                  </a>
                                </div>
                              </div>
                            </div>
                          }

                          @if (hasAnyFrameworkContent() && !hasExampleLink() && getFrameworkInfo()?.docsLink) {
                            <div class="step-item">
                              <div class="step-number">{{ (hasExample() ? 1 : 0) + (hasBuildCommands() ? 1 : 0) + 2 }}</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP_DOCS_TITLE' | translate }}</h6>
                                <p>{{ 'APP.OVERVIEW_DETAIL.NEW_STEP_DOCS_DESC' | translate }}</p>
                                <a
                                  [href]="`https://zitadel.com${getFrameworkInfo()?.docsLink}`"
                                  target="_blank"
                                  mat-raised-button
                                  color="primary"
                                >
                                  {{ 'APP.OVERVIEW_DETAIL.VIEWDOCS' | translate }}
                                </a>
                              </div>
                            </div>
                          }
                        </div>
                      </cnsl-card>
                    </div>
                  }

                  @if (selectedScenario === 'existing') {
                    <div class="existing-app-scenario">
                      <cnsl-info-section>{{ 'APP.OVERVIEW_DETAIL.SCENARIO_EXISTING_DESC' | translate }}</cnsl-info-section>
                      <cnsl-card>
                        <div class="integration-steps">
                          @if (hasSdk()) {
                            <div class="step-item">
                              <div class="step-number">1</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP1_TITLE' | translate }}</h6>
                                <p>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP1_DESC' | translate }}</p>

                                <div class="code-block">
                                  <div class="code-header">
                                    <span>{{ 'APP.OVERVIEW_DETAIL.TERMINAL' | translate }}</span>
                                    <button
                                      mat-icon-button
                                      [disabled]="copied === 'sdk'"
                                      (click)="copyToClipboard(getSdkCommand(), 'sdk')"
                                      matTooltip="{{ 'ACTIONS.COPY' | translate }}"
                                    >
                                      <i
                                        class="las"
                                        [ngClass]="copied === 'sdk' ? 'la-check text-green-500' : 'la-copy'"
                                      ></i>
                                    </button>
                                  </div>
                                  <pre class="code-content">{{ getSdkCommand() }}</pre>
                                </div>
                              </div>
                            </div>
                          }

                          @if (!hasSdk() && !hasAnyFrameworkContent()) {
                            <div class="step-item">
                              <div class="step-number">1</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.GENERIC_EXISTING_TITLE' | translate }}</h6>
                                <div class="generic-guidance">
                                  <p>{{ 'APP.OVERVIEW_DETAIL.GENERIC_EXISTING_NOTE' | translate }}</p>
                                  <div class="generic-links">
                                    <a
                                      href="https://zitadel.com/docs/guides/integrate"
                                      target="_blank"
                                      mat-raised-button
                                      color="primary"
                                    >
                                      {{ 'APP.OVERVIEW_DETAIL.INTEGRATION_GUIDE' | translate }}
                                    </a>
                                    <a href="https://zitadel.com/docs/apis" target="_blank" mat-stroked-button>
                                      {{ 'APP.OVERVIEW_DETAIL.API_DOCS' | translate }}
                                    </a>
                                  </div>
                                </div>
                              </div>
                            </div>
                          }

                          <div class="step-item">
                            <div class="step-number">
                              {{ hasSdk() ? '2' : !hasSdk() && !hasAnyFrameworkContent() ? '2' : '1' }}
                            </div>
                            <div class="step-content">
                              <h6>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP2_TITLE' | translate }}</h6>
                              @if (requiresClientSecret()) {
                                <cnsl-info-section class="client-secret-note">
                                  <span>
                                    {{ 'APP.OVERVIEW_DETAIL.NEW_STEP2_CLIENT_SECRET_NOTE' | translate }}
                                    <a (click)="regenerateOIDCClientSecret()" class="secret-link">{{
                                      'APP.OVERVIEW_DETAIL.NEW_STEP2_CLIENT_SECRET_LINK' | translate
                                    }}</a
                                    >.
                                  </span>
                                </cnsl-info-section>
                              }
                              <cnsl-env-vars-block
                                [envVars]="envVarsArray"
                                [availableFormats]="isExampleEnvMode ? [] : ['env', 'json', 'yaml']"
                                [showDownload]="!isExampleEnvMode"
                                defaultFormat="env"
                              ></cnsl-env-vars-block>
                            </div>
                          </div>

                          @if (hasSdk() && getFrameworkInfo()?.sdkDocLink) {
                            <div class="step-item">
                              <div class="step-number">3</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP_DOCS_TITLE' | translate }}</h6>
                                <p>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP_DOCS_DESC' | translate }}</p>
                                <a
                                  [href]="'https://zitadel.com' + getFrameworkInfo()?.sdkDocLink"
                                  target="_blank"
                                  mat-raised-button
                                  color="primary"
                                >
                                  {{ 'APP.OVERVIEW_DETAIL.VIEWDOCS' | translate }}
                                </a>
                              </div>
                            </div>
                          }
                          @if (hasIntegrationGuide() && getFrameworkInfo()?.integrationGuide) {
                            <div class="step-item">
                              <div class="step-number">2</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP_DOCS_TITLE' | translate }}</h6>
                                <p>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP_DOCS_DESC' | translate }}</p>
                                <a
                                  [href]="'https://zitadel.com' + getFrameworkInfo()?.integrationGuide"
                                  target="_blank"
                                  mat-raised-button
                                  color="primary"
                                >
                                  {{ 'APP.OVERVIEW_DETAIL.VIEWDOCS' | translate }}
                                </a>
                              </div>
                            </div>
                          }
                          @if (
                            !hasSdk() && !hasIntegrationGuide() && hasAnyFrameworkContent() && getFrameworkInfo()?.docsLink
                          ) {
                            <div class="step-item">
                              <div class="step-number">2</div>
                              <div class="step-content">
                                <h6>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP_DOCS_TITLE' | translate }}</h6>
                                <p>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP_DOCS_DESC' | translate }}</p>
                                <a
                                  [href]="'https://zitadel.com' + getFrameworkInfo()?.docsLink"
                                  target="_blank"
                                  mat-raised-button
                                  color="primary"
                                >
                                  {{ 'APP.OVERVIEW_DETAIL.VIEWDOCS' | translate }}
                                </a>
                              </div>
                            </div>
                          }
                          <div class="step-item">
                            <div class="step-number">{{ getExistingAppFinalStepNumber() }}</div>
                            <div class="step-content">
                              <h6>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP3_TITLE' | translate }}</h6>
                              <p>{{ 'APP.OVERVIEW_DETAIL.EXISTING_STEP3_DESC' | translate }}</p>

                              <div class="integration-resources">
                                <div class="resource-links">
                                  <a
                                    [href]="'https://zitadel.com/docs/guides/integrate'"
                                    target="_blank"
                                    mat-raised-button
                                    color="secondary"
                                  >
                                    {{ 'APP.OVERVIEW_DETAIL.INTEGRATION_GUIDE' | translate }}
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </cnsl-card>
                    </div>
                  }
                </div>
              </div>

              <div class="next-steps-section">
                <h4>{{ 'APP.OVERVIEW_DETAIL.NEXTSTEPS' | translate }}</h4>
                <div class="steps-grid">
                  <div class="step-card" (click)="switchToTab('configuration')">
                    <i class="las la-cog"></i>
                    <h5>{{ 'APP.OVERVIEW_DETAIL.CONFIGURE' | translate }}</h5>
                    <p>{{ 'APP.OVERVIEW_DETAIL.CONFIGURE_DESC' | translate }}</p>
                  </div>
                  @if (app?.oidcConfig) {
                    <div class="step-card" (click)="switchToTab('redirect-uris')">
                      <i class="las la-external-link-alt"></i>
                      <h5>{{ 'APP.OVERVIEW_DETAIL.REDIRECTS' | translate }}</h5>
                      <p>{{ 'APP.OVERVIEW_DETAIL.REDIRECTS_DESC' | translate }}</p>
                    </div>
                  }
                  <div class="step-card" (click)="switchToTab('urls')">
                    <i class="las la-link"></i>
                    <h5>{{ 'APP.OVERVIEW_DETAIL.URLS' | translate }}</h5>
                    <p>{{ 'APP.OVERVIEW_DETAIL.URLS_DESC' | translate }}</p>
                  </div>
                </div>
              </div>
            </div>
          </cnsl-card>
        }

        @if (currentSetting.id === 'configuration') {
          <ng-container>
            <cnsl-card *ngIf="oidcForm && app?.oidcConfig" title=" {{ 'APP.OIDC.TITLE' | translate }}">
              <div
                class="current-auth-method"
                *ngIf="currentRadioItemAuthType"
                [ngStyle]="{ background: currentRadioItemAuthType.background }"
              >
                <h3>{{ currentRadioItemAuthType.titleI18nKey | translate }}</h3>
                <p>{{ currentRadioItemAuthType.descI18nKey | translate }}</p>
                <span class="fill-space"></span>
                <button mat-icon-button (click)="changeAuthMethod()"><i class="las la-pen"></i></button>
              </div>

              <form [formGroup]="oidcForm" (ngSubmit)="saveOIDCApp()">
                <div class="app-oidc-content">
                  <div class="app-oidc-grid">
                    <cnsl-form-field class="app-formfield">
                      <cnsl-label>{{ 'APP.OIDC.CLIENTID' | translate }}</cnsl-label>
                      <input cnslInput formControlName="clientId" />
                    </cnsl-form-field>

                    <cnsl-form-field class="app-formfield">
                      <cnsl-label>{{ 'APP.TYPE' | translate }}</cnsl-label>
                      <mat-select formControlName="appType">
                        <mat-option *ngFor="let type of oidcAppTypes" [value]="type">
                          {{ 'APP.OIDC.APPTYPE.' + type | translate }}
                        </mat-option>
                      </mat-select>
                    </cnsl-form-field>

                    <cnsl-form-field class="app-formfield">
                      <cnsl-label>{{ 'APP.OIDC.RESPONSETYPE' | translate }}</cnsl-label>
                      <mat-select formControlName="responseTypesList" multiple>
                        <mat-option *ngFor="let type of oidcResponseTypes" [value]="type">
                          {{ 'APP.OIDC.RESPONSE.' + type | translate }}
                        </mat-option>
                      </mat-select>
                    </cnsl-form-field>

                    <cnsl-form-field class="app-formfield">
                      <cnsl-label>{{ 'APP.AUTHMETHOD' | translate }}</cnsl-label>
                      <mat-select formControlName="authMethodType">
                        <mat-option *ngFor="let type of oidcAuthMethodType" [value]="type">
                          {{ 'APP.OIDC.AUTHMETHOD.' + type | translate }}
                        </mat-option>
                      </mat-select>
                    </cnsl-form-field>

                    <cnsl-form-field class="app-formfield">
                      <cnsl-label>{{ 'APP.OIDC.GRANTTYPE' | translate }}</cnsl-label>
                      <mat-select formControlName="grantTypesList" multiple>
                        <mat-option *ngFor="let grant of oidcGrantTypes" [value]="grant">
                          {{ 'APP.OIDC.GRANT.' + grant | translate }}
                        </mat-option>
                      </mat-select>
                    </cnsl-form-field>

                    <mat-checkbox
                      color="primary"
                      class="rt"
                      (change)="toggleRefreshToken($event)"
                      [disabled]="!grantTypesList?.value.includes(OIDCGrantType.OIDC_GRANT_TYPE_AUTHORIZATION_CODE)"
                      [checked]="grantTypesList?.value.includes(OIDCGrantType.OIDC_GRANT_TYPE_REFRESH_TOKEN)"
                    >
                      {{ 'APP.OIDC.REFRESHTOKEN' | translate }}
                    </mat-checkbox>

                    <mat-checkbox
                      *ngIf="oidcLoginV2"
                      color="primary"
                      class="rt"
                      [formControl]="oidcLoginV2"
                      name="loginV2"
                      matTooltip="{{ 'APP.LOGINV2DESC' | translate }}"
                    >
                      {{ 'APP.LOGINV2.USEV2' | translate }}
                    </mat-checkbox>

                    <cnsl-form-field class="app-formfield">
                      <cnsl-label>{{ 'APP.LOGINV2.BASEURL' | translate }}</cnsl-label>
                      <input cnslInput formControlName="loginV2BaseURL" />
                    </cnsl-form-field>
                  </div>
                </div>

                <div class="btn-container">
                  <button
                    class="submit-button"
                    type="submit"
                    color="primary"
                    [disabled]="oidcForm.invalid || !canWrite"
                    mat-raised-button
                  >
                    {{ 'ACTIONS.SAVE' | translate }}
                  </button>
                </div>
              </form>
            </cnsl-card>

            <cnsl-card *ngIf="samlForm && app?.samlConfig" title="{{ 'APP.SAML.CONFIGSECTION' | translate }}">
              <h3 class="title cnsl-secondary-text">
                {{ 'APP.SAML.CHOOSEMETADATASOURCE' | translate }}
              </h3>

              <div class="metadata-option">
                <span class="saml-config-option">{{ 'APP.SAML.METADATAOPT1' | translate }}</span>
                <form [formGroup]="samlForm">
                  <cnsl-form-field class="formfield">
                    <input cnslInput formControlName="metadataUrl" placeholder="https://" />
                  </cnsl-form-field>
                </form>
              </div>

              <div class="metadata-option">
                <span class="saml-config-option">{{ 'APP.SAML.METADATAOPT2' | translate }}</span>
                <input
                  #xmlFileInput
                  style="display: none"
                  class="file-input"
                  type="file"
                  accept="text/xml,application/xml"
                  (change)="onDropXML($any($event.target).files)"
                />
                <button class="upload-button" mat-stroked-button (click)="$event.preventDefault(); xmlFileInput.click()">
                  {{ 'APP.SAML.UPLOAD' | translate }}
                </button>
              </div>

              <div class="metadata-option">
                <span class="saml-config-option">{{ 'APP.SAML.METADATAOPT3' | translate }}</span>
                <form [formGroup]="samlForm">
                  <cnsl-form-field class="formfield">
                    <cnsl-label>{{ 'APP.SAML.ENTITYID' | translate }}</cnsl-label>
                    <input cnslInput formControlName="entityId" placeholder="https://" />
                  </cnsl-form-field>
                  <cnsl-form-field class="formfield">
                    <cnsl-label>{{ 'APP.SAML.ACSURL' | translate }}</cnsl-label>
                    <input cnslInput formControlName="acsURL" placeholder="https://" />
                  </cnsl-form-field>
                </form>
              </div>

              <div
                class="saml-xml"
                [ngClass]="{ disabled: !!metadataUrl?.value }"
                *ngIf="decodedBase64 && app && app.samlConfig && !app.samlConfig.metadataUrl"
              >
                <ngx-codemirror
                  [(ngModel)]="decodedBase64"
                  [disabled]="!!metadataUrl?.value"
                  [options]="{
                    lineNumbers: true,
                    theme: 'material',
                    mode: 'application/xml',
                  }"
                ></ngx-codemirror>
              </div>

              <div class="saml-login-version">
                <form [formGroup]="samlForm">
                  <mat-checkbox
                    *ngIf="samlLoginV2"
                    color="primary"
                    class="rt"
                    [formControl]="samlLoginV2"
                    name="loginV2"
                    matTooltip="{{ 'APP.LOGINV2DESC' | translate }}"
                  >
                    {{ 'APP.LOGINV2.USEV2' | translate }}
                  </mat-checkbox>

                  <cnsl-form-field class="app-formfield">
                    <cnsl-label>{{ 'APP.LOGINV2.BASEURL' | translate }}</cnsl-label>
                    <input cnslInput formControlName="loginV2BaseURL" />
                  </cnsl-form-field>
                </form>
              </div>

              <div class="btn-container">
                <button
                  class="submit-button"
                  type="submit"
                  color="primary"
                  (click)="saveSAMLApp()"
                  [disabled]="samlForm.invalid || !canWrite"
                  mat-raised-button
                >
                  {{ 'ACTIONS.SAVE' | translate }}
                </button>
              </div>
            </cnsl-card>
          </ng-container>
        }

        <ng-container *ngIf="currentSetting.id === 'token'">
          <cnsl-card *ngIf="oidcTokenForm && app?.oidcConfig" title=" {{ 'APP.OIDC.TOKENSECTIONTITLE' | translate }}">
            <form [formGroup]="oidcTokenForm" (ngSubmit)="saveOIDCApp()">
              <cnsl-form-field class="app-formfield">
                <cnsl-label>{{ 'APP.OIDC.TOKENTYPE' | translate }}</cnsl-label>
                <mat-select formControlName="accessTokenType">
                  <mat-option *ngFor="let type of oidcTokenTypes" [value]="type">
                    {{ 'APP.OIDC.TOKENTYPE' + type | translate }}
                  </mat-option>
                </mat-select>
              </cnsl-form-field>

              <mat-checkbox
                *ngIf="accessTokenType?.value === OIDCTokenType.OIDC_TOKEN_TYPE_JWT"
                class="full-width"
                style="margin-top: 1.5rem"
                formControlName="accessTokenRoleAssertion"
                color="primary"
              >
                {{ 'APP.OIDC.ACCESSTOKENROLEASSERTION' | translate }}</mat-checkbox
              >

              <cnsl-info-section class="full-width app-desc">
                <span>{{ 'APP.OIDC.ACCESSTOKENROLEASSERTION_DESCRIPTION' | translate }}</span>
              </cnsl-info-section>

              <mat-checkbox
                class="full-width"
                style="margin-top: 1.5rem"
                formControlName="idTokenRoleAssertion"
                color="primary"
              >
                {{ 'APP.OIDC.IDTOKENROLEASSERTION' | translate }}</mat-checkbox
              >
              <cnsl-info-section class="full-width app-desc">
                <span>{{ 'APP.OIDC.IDTOKENROLEASSERTION_DESCRIPTION' | translate }}</span>
              </cnsl-info-section>

              <mat-checkbox
                class="full-width"
                style="margin-top: 1.5rem"
                formControlName="idTokenUserinfoAssertion"
                color="primary"
              >
                {{ 'APP.OIDC.IDTOKENUSERINFOASSERTION' | translate }}</mat-checkbox
              >
              <cnsl-info-section class="full-width app-desc">
                <span>{{ 'APP.OIDC.IDTOKENUSERINFOASSERTION_DESCRIPTION' | translate }}</span>
              </cnsl-info-section>

              <p class="clockskew-title cnsl-secondary-text">ClockSkew</p>
              <!-- TODO: The 'tickInterval' property no longer exists -->
              <mat-slider
                color="primary"
                class="clockskew-slider"
                thumbLabel
                [displayWith]="formatClockSkewLabel"
                min="0"
                [step]="1"
                max="5"
                ><input matSliderThumb formControlName="clockSkewSeconds" />
              </mat-slider>
              <cnsl-info-section class="full-width app-desc">
                <span>{{ 'APP.OIDC.CLOCKSKEW' | translate }}</span>
              </cnsl-info-section>

              <div class="btn-container">
                <button
                  class="submit-button"
                  type="submit"
                  color="primary"
                  [disabled]="oidcTokenForm.invalid || !canWrite"
                  mat-raised-button
                >
                  {{ 'ACTIONS.SAVE' | translate }}
                </button>
              </div>
            </form>
          </cnsl-card>
        </ng-container>

        <ng-container *ngIf="currentSetting.id === 'redirect-uris'">
          <cnsl-card title=" {{ 'APP.OIDC.REDIRECTSECTIONTITLE' | translate }}">
            <cnsl-info-section *ngIf="appType?.value === OIDCAppType.OIDC_APP_TYPE_NATIVE">
              <div class="dev-col">
                <span>{{ 'APP.OIDC.REDIRECTDESCRIPTIONNATIVE' | translate }}</span>
                <mat-slide-toggle
                  *ngIf="devMode"
                  color="primary"
                  class="devmode"
                  [formControl]="devMode"
                  name="devMode"
                  matTooltip="{{ 'APP.OIDC.DEVMODEDESC' | translate }}"
                >
                  {{ 'APP.OIDC.DEVMODE' | translate }}
                </mat-slide-toggle>
              </div>
            </cnsl-info-section>
            <cnsl-info-section
              *ngIf="
                appType?.value === OIDCAppType.OIDC_APP_TYPE_WEB || appType?.value === OIDCAppType.OIDC_APP_TYPE_USER_AGENT
              "
            >
              <div class="dev-col">
                <span>{{ 'APP.OIDC.REDIRECTDESCRIPTIONWEB' | translate }}</span>
                <mat-slide-toggle
                  *ngIf="devMode"
                  color="primary"
                  class="devmode"
                  [formControl]="devMode"
                  name="devMode"
                  matTooltip="{{ 'APP.OIDC.DEVMODEDESC' | translate }}"
                >
                  {{ 'APP.OIDC.DEVMODE' | translate }}
                </mat-slide-toggle>
              </div>
            </cnsl-info-section>

            <mat-checkbox
              *ngIf="skipNativeAppSuccessPage && appType?.value === OIDCAppType.OIDC_APP_TYPE_NATIVE"
              class="full-width"
              style="margin-top: 1.5rem"
              [formControl]="skipNativeAppSuccessPage"
              color="primary"
            >
              {{ 'APP.OIDC.SKIPNATIVEAPPSUCCESSPAGE' | translate }}</mat-checkbox
            >
            <cnsl-info-section *ngIf="appType?.value === OIDCAppType.OIDC_APP_TYPE_NATIVE" class="full-width app-desc">
              <span>{{ 'APP.OIDC.SKIPNATIVEAPPSUCCESSPAGE_DESCRIPTION' | translate }}</span>
            </cnsl-info-section>

            <cnsl-redirect-uris
              *ngIf="appType?.value !== undefined"
              class="redirect-section"
              [disabled]="!canWrite"
              [devMode]="!!devMode?.value"
              [(ngModel)]="redirectUrisList"
              title="{{ 'APP.OIDC.REDIRECT' | translate }}"
              [isNative]="appType?.value === OIDCAppType.OIDC_APP_TYPE_NATIVE"
            >
            </cnsl-redirect-uris>

            <cnsl-redirect-uris
              *ngIf="appType?.value !== undefined"
              class="redirect-section"
              [disabled]="!canWrite"
              [devMode]="!!devMode?.value"
              [(ngModel)]="postLogoutRedirectUrisList"
              title="{{ 'APP.OIDC.POSTLOGOUTREDIRECT' | translate }}"
              [isNative]="appType?.value === OIDCAppType.OIDC_APP_TYPE_NATIVE"
            >
            </cnsl-redirect-uris>

            <div class="btn-container">
              <button class="submit-button" color="primary" (click)="saveOIDCApp()" [disabled]="!canWrite" mat-raised-button>
                {{ 'ACTIONS.SAVE' | translate }}
              </button>
            </div>
          </cnsl-card>
        </ng-container>

        <ng-container *ngIf="currentSetting.id === 'additional-origins'">
          <cnsl-card title=" {{ 'APP.ADDITIONALORIGINS' | translate }}">
            <p class="app-desc cnsl-secondary-text">{{ 'APP.ADDITIONALORIGINSDESC' | translate }}</p>
            <cnsl-additional-origins
              *ngIf="additionalOriginsList && appType && appType?.value !== undefined"
              class="app-input"
              [canWrite]="canWrite"
              [getValues]="requestRedirectValuesSubject$"
              (changedUris)="additionalOriginsListChanged($event)"
              [urisList]="additionalOriginsList"
              title="{{ 'APP.ORIGINS' | translate }}"
            >
            </cnsl-additional-origins>

            <div class="btn-container">
              <button class="submit-button" (click)="saveOIDCApp()" color="primary" [disabled]="!canWrite" mat-raised-button>
                {{ 'ACTIONS.SAVE' | translate }}
              </button>
            </div>
          </cnsl-card>
        </ng-container>
        <ng-container *ngIf="currentSetting.id === 'urls'">
          <cnsl-card title=" {{ 'APP.URLS' | translate }}">
            <cnsl-info-section *ngIf="issuer$ | async as issuer">
              <div
                class="link"
                [innerHtml]="'APP.OIDC.WELLKNOWN' | translate: { url: issuer + '/.well-known/openid-configuration' }"
              ></div>
            </cnsl-info-section>
            <ng-container *ngIf="app?.apiConfig && apiURLs$ | async as apiURLs">
              <cnsl-copy-row
                labelMinWidth="220px"
                *ngFor="let apiUrl of apiURLs"
                [label]="apiUrl[0]"
                [value]="apiUrl[1]"
              ></cnsl-copy-row>
            </ng-container>
            <ng-container *ngIf="app?.samlConfig && samlURLs$ | async as samlMap">
              <cnsl-copy-row
                labelMinWidth="220px"
                *ngIf="samlMap['samlCertificateURL'] as url"
                [label]="'APP.SAML.CERTIFICATE' | translate"
                [value]="url"
              >
                <a class="download-button" mat-stroked-button [href]="url" download>{{ 'ACTIONS.DOWNLOAD' | translate }}</a>
              </cnsl-copy-row>
              <cnsl-copy-row
                labelMinWidth="220px"
                *ngIf="samlMap['samlSSO'] as url"
                label="Single Sign On (SSO)"
                [value]="url"
              ></cnsl-copy-row>
              <cnsl-copy-row
                labelMinWidth="220px"
                *ngIf="samlMap['samlSLO'] as url"
                label="Single Logout (SLO)"
                [value]="url"
              ></cnsl-copy-row>
            </ng-container>
            <ng-container *ngIf="app?.oidcConfig && wellknownURLs$ | async as wellKnownURLs">
              <ng-container *ngFor="let wellknown of wellKnownURLs">
                <cnsl-copy-row labelMinWidth="220px" [label]="wellknown[0]" [value]="wellknown[1]"></cnsl-copy-row>
              </ng-container>
            </ng-container>
          </cnsl-card>
        </ng-container>

        <ng-container *ngIf="currentSetting.id === 'configuration'">
          <cnsl-card
            *ngIf="initialAuthMethod === 'PK_JWT' && projectId && app && app.id"
            title="{{ 'USER.MACHINE.KEYSTITLE' | translate }}"
            description="{{ 'USER.MACHINE.KEYSDESC' | translate }}"
          >
            <cnsl-client-keys [projectId]="projectId" [appId]="app.id"></cnsl-client-keys>

            <div *ngIf="apiForm && app?.apiConfig" class="btn-container">
              <button
                class="submit-button"
                (click)="saveAPIApp()"
                color="primary"
                [disabled]="apiForm.invalid || !canWrite"
                mat-raised-button
              >
                {{ 'ACTIONS.SAVE' | translate }}
              </button>
            </div>
          </cnsl-card>
        </ng-container>
      </cnsl-sidenav>

      <div metainfo>
        <div
          class="compliance"
          *ngIf="
            app && app.oidcConfig && app.oidcConfig.complianceProblemsList && app.oidcConfig.complianceProblemsList?.length
          "
        >
          <h2 class="compliance-title">{{ 'APP.COMPLIANCE' | translate }}</h2>
          <div *ngFor="let problem of app.oidcConfig?.complianceProblemsList || []">
            <cnsl-info-section class="problem" [type]="InfoSectionType.ALERT">
              {{ problem.localizedMessage }}
            </cnsl-info-section>
          </div>
        </div>
        <cnsl-changes *ngIf="app" [changeType]="ChangeType.APP" [id]="app.id" [secId]="projectId"></cnsl-changes>
      </div>
    </cnsl-meta-layout>
  </div>
</div>
