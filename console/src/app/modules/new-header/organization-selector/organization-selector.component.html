<div cdkTrapFocus class="focus-trapper">
  <div class="org-header">
    @if (backButton) {
      <button (click)="backButtonPressed.emit()" mat-button class="dropdown-button">
        <span class="back-button">
          <ng-icon name="heroArrowLeftCircleSolid"></ng-icon>
          <h3>Back to {{ backButton }}</h3>
        </span>
      </button>
    }
    <span class="dropdown-label">{{ 'MENU.ORGANIZATION' | translate }}</span>
    <form [formGroup]="form" class="form">
      <ng-icon class="search-icon" name="heroMagnifyingGlass"></ng-icon>
      <input
        class="search-input"
        autocomplete="off"
        cnslInput
        [formControl]="form.controls.name"
        [placeholder]="'PROJECT.GRANT.CREATE.SEL_ORG' | translate"
        />
    </form>
  </div>
  <div class="org-list">
    <!-- Make sure active org is always at the top -->
    @if (activeOrgIfSearchMatches(); as org) {
      <a class="dropdown-button" mat-button (click)="changeOrg(org.id)">
        {{ org.name }}
        <ng-icon name="heroCheck"></ng-icon>
      </a>
    }
    @if (organizationsQuery.data(); as data) {
      @for (org of data.orgs; track trackOrgResponse($index, org)) {
        @if (org.id !== activeOrg.data()?.id) {
          <a class="dropdown-button" mat-button (click)="changeOrg(org.id)">
            {{ org.name }}
          </a>
        }
      }
      @if (data?.totalResult; as totalResult) {
        @if (totalResult > QUERY_LIMIT) {
          <button
            #moreButton
            class="dropdown-button"
            mat-stroked-button
            (click)="organizationsQuery.fetchNextPage()"
            [disabled]="!organizationsQuery.hasNextPage() || organizationsQuery.isFetchingNextPage()"
            >
            @if (['iam.read'] | hasRole | async) {
              ...{{ totalResult - data.orgs.length }}
            }
            {{ 'PAGINATOR.MORE' | translate }}
          </button>
        }
      }
    }
  </div>
</div>
