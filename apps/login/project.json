{
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "targets": {
    "prod": {
      "description": "Runs the Next.js Login application in production mode from the standalone build",
      "continuous": true,
      "dependsOn": [
        "build"
      ],
      "defaultConfiguration": "default",
      "configurations": {
        "default": {}
      }
    },
    "dev": {
      "description": "Runs the Next.js Login application in development mode with hot-reloading",
      "continuous": true,
      "dependsOn": [
        "^build"
      ]
    },
    "build": {
      "description": "Builds the Next.js Login application in standalone mode for production",
      "cache": true,
      "dependsOn": [
        "^build"
      ],
      "inputs": [
        "default",
        "{workspaceRoot}/pnpm-lock.yaml",
        "!{projectRoot}/.env.*",
        "!{projectRoot}/.local.env",
        "!{projectRoot}/acceptance/**/*",
        "!{projectRoot}/dockerized/**/*"
      ],
      "outputs": [
        "{projectRoot}/.next/standalone"
      ]
    },
    "build-vercel": {
      "description": "Builds the Next.js Login application for Vercel deployment",
      "cache": true,
      "dependsOn": [
        "^build"
      ],
      "inputs": [
        "default",
        "{workspaceRoot}/pnpm-lock.yaml",
        "!{projectRoot}/.env.*",
        "!{projectRoot}/.local.env",
        "!{projectRoot}/acceptance/**/*",
        "!{projectRoot}/dockerized/**/*"
      ],
      "outputs": [
        "{projectRoot}/.next",
        "!{projectRoot}/.next/cache",
        "!{projectRoot}/.next/standalone"
      ]
    },
    "lint": {
      "description": "Runs all linters",
      "dependsOn": [
        "lint-check-*"
      ]
    },
    "lint-check-prettier": {
      "description": "Checks code formatting with Prettier",
      "cache": true,
      "inputs": [
        "default"
      ]
    },
    "lint-check-next": {
      "description": "Runs Next.js specific lint checks",
      "cache": true,
      "inputs": [
        "default"
      ]
    },
    "test": {
      "description": "Runs all tests (unit and integration)",
      "dependsOn": [
        "test-unit"
      ]
    },
    "test-unit": {
      "description": "Runs unit tests using Vitest",
      "dependsOn": [
        "^build"
      ]
    },
    "test-ca": {
      "description": "Runs custom CA certificate integration tests using testcontainers",
      "dependsOn": [
        "build"
      ],
      "executor": "nx:run-commands",
      "cache": true,
      "inputs": [
        "default",
        "!{projectRoot}/acceptance/**/*",
        "!{projectRoot}/dockerized/**/output/**/*"
      ],
      "options": {
        "cwd": "{projectRoot}",
        "commands": [
          "pnpm vitest --run --config vitest.config.ca.mts"
        ]
      }
    },

    "pack": {
      "description": "Packages the standalone Login application build into an archive",
      "dependsOn": [
        "build"
      ],
      "executor": "nx:run-commands",
      "options": {
        "parallel": false,
        "env": {
          "STANDALONE_DIR": "{projectRoot}/.next/standalone",
          "PACK_DIR": "{workspaceRoot}/.artifacts/pack"
        },
        "commands": [
          "mkdir -p ${PACK_DIR}",
          "tar -czf ${PACK_DIR}/zitadel-login.tar.gz -C ${STANDALONE_DIR} ."
        ]
      },
      "cache": true,
      "outputs": [
        "{workspaceRoot}/.artifacts/pack/zitadel-login.tar.gz"
      ]
    }
  }
}