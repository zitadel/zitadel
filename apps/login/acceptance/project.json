{
    "$schema": "../../../node_modules/nx/schemas/project-schema.json",
    "targets": {
        "test": {
            "description": "Runs the Playwright tests for the Login application",
            "dependsOn": [
                "run-mock-server",
                "run-login",
                "run-db",
                "run-api"
            ],
            "options": {
                "cwd": "{projectRoot}"
            },
            "command": "wait-on --verbose --interval 2000 --simultaneous 1 \"${ZITADEL_API_URL}/debug/ready\" \"${LOGIN_BASE_URL}\" \"http://localhost:3333/ready\" && playwright test",
            "inputs": [
                "default"
            ]
        },
        "run-mock-server": {
            "description": "Runs the mock server for the Login acceptance tests",
            "continuous": true,
            "options": {
                "cwd": "{projectRoot}"
            },
            "command": "wait-on --verbose --interval 2000 --simultaneous 1 \"${ZITADEL_API_URL}/debug/ready\" && tsx ./mock/server.ts"
        },
        "run-login": {
            "description": "Runs the Login application for running acceptance tests",
            "continuous": true,
            "dependsOn": [
                "@zitadel/login:build",
                "setup-api"
            ],
            "command": "nx run @zitadel/login:prod --excludeTaskDependencies"
        },
         "run-db": {
            "description": "Runs an ephemeral database for running acceptance tests",
            "continuous": true,
            "command": "nx run @zitadel/devcontainer:compose up --force-recreate --renew-anon-volumes db-login-acceptance"
        },
        "run-api": {
            "description": "Runs the API for running acceptance tests",
            "continuous": true,
            "dependsOn": [
                "run-db",
                "setup-api"
            ],
            "executor": "nx:run-commands",
            "options": {
                "env": {
                    "API_CONFIG_FILE": "{projectRoot}/api.yaml"
                },
                "command": "nx run @zitadel/api:prod --excludeTaskDependencies"
            }
        },
        "setup-api": {
            "description": "Sets up the API for running acceptance tests",
            "dependsOn": [
                "run-db",
                "build-api"
            ],
            "executor": "nx:run-commands",
            "options": {
                "env": {
                    "API_CONFIG_FILE": "{projectRoot}/api.yaml"
                },
                "command": "nx run @zitadel/api:setup --excludeTaskDependencies"
            }
        },
        "build-api": {
            "dependsOn": [
                "generate-stubs",
                "generate-assets",
                "generate-statik"
            ],
            "command": "nx run @zitadel/api:build --excludeTaskDependencies"
        }
   }
}