# Example Docker Compose with secrets configuration
# This example shows how to use Docker secrets with ZITADEL
services:
  zitadel:
    image: zitadel/zitadel:latest
    environment:
      # Use _FILE environment variables to read from Docker secrets
      ZITADEL_DATABASE_POSTGRES_USER_PASSWORD_FILE: /run/secrets/db_password
      ZITADEL_DATABASE_POSTGRES_ADMIN_PASSWORD_FILE: /run/secrets/db_admin_password
      ZITADEL_MASTERKEY_FILE: /run/secrets/masterkey
      
      # Regular configuration can still use environment variables
      ZITADEL_DATABASE_POSTGRES_HOST: postgres
      ZITADEL_DATABASE_POSTGRES_PORT: 5432
      ZITADEL_DATABASE_POSTGRES_DATABASE: zitadel
      ZITADEL_DATABASE_POSTGRES_USER_USERNAME: zitadel_user
      ZITADEL_DATABASE_POSTGRES_ADMIN_USERNAME: postgres    

    secrets:
      - db_password
      - db_admin_password
      - masterkey
    depends_on:
      postgres:
        condition: service_healthy

  postgres:
    # ...
    environment:
      POSTGRES_DB: zitadel
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD_FILE: /run/secrets/db_admin_password
    secrets:
      - db_admin_password
    # ...

secrets:
  db_password:
    file: ./secrets/db_password.txt
  db_admin_password:
    file: ./secrets/db_admin_password.txt
  masterkey:
    file: ./secrets/masterkey.txt
