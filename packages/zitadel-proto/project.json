{
  "$schema": "../../node_modules/nx/schemas/project-schema.json",
  "name": "@zitadel/proto",
  "targets": {
    "nx-release-publish": {
      "description": "Sets the package name to the GitHub org scope for publishing to GitHub Packages. This allows to publish the package on forks.",
      "dependsOn": [
        "generate",
        "link-to-repo",
        "configure-npmrc"
      ]
    },
    "link-to-repo": {
      "description": "Sets the package name to the GitHub org scope for publishing to GitHub Packages. Also links the package to the GitHub repository. This allows to publish the package on forks.",
      "executor": "nx:run-commands",
      "options": {
        "cwd": "{projectRoot}",
        "command": "npm pkg set name=\"@${ZITADEL_RELEASE_GITHUB_ORG}/proto\" repository=\"https://github.com/${ZITADEL_RELEASE_GITHUB_REPO}\""
      }
    },
    "configure-npmrc": {
      "description": "Configures the root workspace .npmrc file to publish to GitHub Packages.",
      "command": "bash -c 'grep -qxF @${ZITADEL_RELEASE_GITHUB_ORG}:registry=https://npm.pkg.github.com ./.npmrc || echo @${ZITADEL_RELEASE_GITHUB_ORG}:registry=https://npm.pkg.github.com >> ./.npmrc'"
    },
    "generate": {
      "inputs": [
        "default",
        "{workspaceRoot}/pnpm-lock.yaml",
        "{workspaceRoot}/proto/**/*"
      ],
      "outputs": [
        "{projectRoot}/cjs",
        "{projectRoot}/es",
        "{projectRoot}/types"
      ]
    }
  }
}