name: Login Container

on:
  workflow_call:
    inputs:
      login_build_image:
        description: 'The image name of the built production standalone login image'
        type: string
        required: true

jobs:
  login-container:
    name: Build Login Container
    runs-on: depot-ubuntu-22.04-8
    permissions:
      id-token: write
    steps:
      - uses: actions/checkout@v4
      - uses: depot/setup-action@v1
        with:
          oidc: true
      - name: Build Login Container
        run: make login_standalone_build
        env:
          # latest if branch is main, otherwise image version which is the pull request number
          LOGIN_BAKE_CLI: depot bake
          DEPOT_PROJECT_ID: w47wkxzdtw
          LOGIN_TAG: ${{ inputs.login_build_image }}
